name: Validate PR title or last commit message
env:
  PR_TITLE: ${{ github.event.pull_request.title }}
run: |
  set -e
  
  echo "üîé PR Title: $PR_TITLE"
  
  LAST_COMMIT_MSG=$(git log -1 --pretty=%B)
  echo "üîé Last Commit Message: $LAST_COMMIT_MSG"
  
  # Function to test a message against all patterns using grep
  check_patterns() {
    local msg="$1"
    echo "$msg" | grep -qE '^\[HIF-[0-9]+\] .+' && return 0
    echo "$msg" | grep -qE '^\[PLM-P[0-9]+-[0-9]+\] .+' && return 0
    echo "$msg" | grep -qE '^Coding style for [""][[][PLM-P[0-9]+-[0-9]+[]]' && return 0
    echo "$msg" | grep -qE '^Coding style for [""][[][HIF-[0-9]+[]]' && return 0
    return 1
  }
  
  if check_patterns "$PR_TITLE"; then
    echo "‚úÖ Valid pattern found in PR title."
    exit 0
  fi
  
  if check_patterns "$LAST_COMMIT_MSG"; then
    echo "‚úÖ Valid pattern found in last commit message."
    exit 0
  fi
  
  echo "‚ùå Invalid PR title or commit message."
  echo "PR title or last commit message must match one of these formats:"
  echo "  [HIF-123] Some message"
  echo "  [PLM-P12-345] Some message"
  echo "  Coding style for \"[HIF-123] Some message\""
  echo "  Coding style for \"[PLM-P12-345] Some message\""
  exit 1
